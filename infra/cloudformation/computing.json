{
  "Description": "Computing",
  "Parameters": {},
  "Outputs": {
    "SecurityGroupEC2": {
      "Description": "SecurityGroup Bastion",
      "Value": { "Ref": "SecurityGroupEC2" },
      "Export": {
        "Name": "SecurityGroupEC2"
      }
    }
  },
  "Resources": {
    "Ec2Bastion": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "ImageId": "ami-02a2700d37baeef8b",
        "KeyName": "keypair-sandbox",
        "InstanceType": "t2.micro",
        "BlockDeviceMappings": [
          {
            "DeviceName": "/dev/sdc",
            "VirtualName": "ephemeral0"
          }
        ],
        "NetworkInterfaces": [
          {
            "SubnetId": {
              "Fn::ImportValue": "PublicSubnetA"
            },
            "DeviceIndex": 0,
            "GroupSet": [
              {
                "Ref": "SecurityGroupEC2"
              }
            ]
          }
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "tBastion"
          }
        ]
      }
    },
    "SecurityGroupEC2": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "VpcId": {
          "Fn::ImportValue": "VPC"
        },
        "GroupDescription": "security group for bastion",
        "SecurityGroupIngress": [
          {
            "IpProtocol": "tcp",
            "FromPort": 22,
            "ToPort": 22,
            "CidrIp": { "Fn::ImportValue": "VPC" }
          }
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "tSecurityGroupEC2"
          }
        ]
      }
    },
    "SceduleEC2Stop": {
      "Type": "AWS::Scheduler::Schedule",
      "Properties": {
        "Description": "",
        "FlexibleTimeWindow": { "Mode": "OFF" },
        "Name": "tStopEC2Bastion",
        "ScheduleExpression": "0 0 0 * ? *",
        "Target": {
          "Arn": { "Ref": "Ec2Bastion" },
          "RoleArn": "arn:aws:iam::194049872315:role/EventScheduler-EC2StopRole"
        }
      }
    }
  }
}
